description: >
  Distribute an iOS app by uploading the binary(ipa)
parameters:
  path:
    type: string
    description: "Path of your app binary"
  release_note:
    type: string
    description: "This will be shown in each distribution site"
    default: ""
steps:
  - store_artifacts:
      path: <<parameters.path>>
  - run:
      name: Generate page
      environment:
        APP_PATH: <<parameters.path>>
      command: |
        gem install ipa_analyzer
        APP_DATA=$(ipa_analyzer -i $APP_PATH -p --info-plist --prov)
        VERSION_NAME=$(echo $APP_DATA | jq -r '.info_plist | .content | .CFBundleShortVersionString')
        echo $VERSION_NAME
        VERSION_CODE=$(echo $APP_DATA | jq -r '.info_plist | .content | .CFBundleVersion')
        echo $VERSION_CODE
        APP_NAME=$(echo $APP_DATA | jq -r '.info_plist | .content | .CFBundleName')
        echo $APP_NAME
        IDENTIFIER=$(echo $APP_DATA | jq -r '.info_plist | .content | .CFBundleIdentifier')
        echo $APP_NAME
