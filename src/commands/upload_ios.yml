description: >
  Distribute an iOS app by uploading the binary(ipa)
parameters:
  path:
    type: string
    description: "Path of your app binary"
  release_note:
    type: string
    description: "This will be shown in each distribution site"
    default: ""
steps:
  - store_artifacts:
      path: <<parameters.path>>
  - run:
      name: Generate page
      environment:
        APP_PATH: <<parameters.path>>
      command: |
        PLIST=$(unzip -p ${APP_PATH} Payload/*.app/Info.plist | plutil -convert json -o - -- -)
        SHORT_VERSION=$(echo ${PLIST} | jq -r .CFBundleShortVersionString)
        echo "CFBundleShortVersionString: ${SHORT_VERSION}"

        BUNDLE_VERSION=$(echo ${APP_PATH} | jq -r .CFBundleVersion | sed -E -e 's/^.*\.//')
        echo "CFBundleVersion: ${BUNDLE_VERSION}"
