description: >
  Distribute an Android app by uploading the binary(aab, apk)
parameters:
  path:
    type: string
    description: "Path of your app binary"
  release_note:
    type: string
    description: "This will be shown in each distribution site"
    default: ""
  build_tools_version:
    type: string
    description: Version of Android SDK Build Tools, you can see available versions in $ANDROID_HOME/build-tools/
    default: 30.0.3
steps:
  - store_artifacts:
      path: <<parameters.path>>
  - run:
      name: Generate Page
      environment:
        APP_PATH: <<parameters.path>>
        BUILD_TOOLS_VERSION: <<parameters.build_tools_version>>
      command: |
        APP_DATA=$(${ANDROID_HOME}/build-tools/${BUILD_TOOLS_VERSION}/aapt2 dump badging ${APP_PATH})

        APP_NAME=$(echo ${APP_DATA} | grep "application: label=" | sed -e "s/.*application: label='//" -e "s/' .*//")
        RELEASE_VERSION=$(echo ${APP_DATA} | grep "versionName" | sed -e "s/.*versionName='//" -e "s/' .*//")
        BUILD_VERSION=$(echo ${APP_DATA} | grep "versionCode" | sed -e "s/.*versionCode='//" -e "s/' .*//")
        IDENTIFIER=$(echo ${APP_DATA} | grep "package: name" | sed -e "s/.*package: name='//" -e "s/' .*//")
