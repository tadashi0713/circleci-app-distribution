description: >
  This command echos "Hello World" using file inclusion.
# What will this command do?
# Descriptions should be short, simple, and clear.
parameters:
  path:
    type: string
    description: "Path of your app binary"
  circle_token:
    description: >
      CircleCI token for fetching flaky tests via API.
      If not specified, CIRCLE_TOKEN environment variable will be used.
      Please refer to this document how to generate it.
      https://circleci.com/docs/managing-api-tokens (requires a v2 token)
    default: $CIRCLE_TOKEN
    type: string
steps:
  - ruby/install-deps
  - store_artifacts:
      path: <<parameters.path>>
  - run:
      name: Get app url
      environment:
        CIRCLE_TOKEN: <<parameters.circle_token>>
        ARTIFACT_URL_NAME: APP_URL
      command: <<include(scripts/get_latest_artifact_url.sh)>>
  - run:
      name: Generate page
      command: <<include(scripts/generate_android_page.sh)>>
  - store_artifacts:
      path: page.html
  - run:
      name: Get page url
      environment:
        CIRCLE_TOKEN: <<parameters.circle_token>>
        ARTIFACT_URL_NAME: PAGE_URL
      command: <<include(scripts/get_latest_artifact_url.sh)>>
  - run:
      name: Install qrencode
      command: <<include(scripts/install_qrencode.sh)>>
  - run:
      name: Show QR in CLI
      command: <<include(scripts/show_qr_cli.sh)>>
