description: >
  This command echos "Hello World" using file inclusion.
# What will this command do?
# Descriptions should be short, simple, and clear.
parameters:
  path:
    type: string
    description: "Path of your app binary"
  circle_token:
    description: >
      CircleCI token for fetching flaky tests via API.
      If not specified, CIRCLE_TOKEN environment variable will be used.
      Please refer to this document how to generate it.
      https://circleci.com/docs/managing-api-tokens (requires a v2 token)
    default: $CIRCLE_TOKEN
    type: string
steps:
  - store_artifacts:
      path: <<parameters.path>>
  - run:
      name: Get artifact url
      environment:
        CIRCLE_TOKEN: <<parameters.circle_token>>
      command: <<include(scripts/get_latest_artifact_url.sh)>>
  - run:
      name: Echo $ARTIFACT_URL
      command: echo $ARTIFACT_URL
  - run:
      name: Create page name
      command: echo "export PAGE_NAME=$(date +%s)" >> "$BASH_ENV"
  - run:
      name: Generate page
      command: <<include(scripts/generate_page.sh)>>
  - store_artifacts:
      path: ${PAGE_NAME}.html
  - run:
      name: Get $ARTIFACT_URL
      environment:
        CIRCLE_TOKEN: <<parameters.circle_token>>
      command: <<include(scripts/get_latest_artifact_url.sh)>>
  - run:
      name: Echo $ARTIFACT_URL
      command: echo $ARTIFACT_URL
